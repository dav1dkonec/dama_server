<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:dama_klient_app.ViewModels"
             xmlns:primitives="clr-namespace:Avalonia.Controls.Primitives;assembly=Avalonia.Controls"
             x:Class="dama_klient_app.Views.GameView"
             x:DataType="vm:GameViewModel">
    <UserControl.Styles>
        <!-- Zajistit viditelné komponenty i v dark mode -->
        <Style Selector="TextBlock">
            <Setter Property="Foreground" Value="#111111" />
        </Style>
        <Style Selector="Button">
            <Setter Property="Foreground" Value="#111111" />
            <Setter Property="Background" Value="#eaeaea" />
        </Style>
        <Style Selector="Button:pointerover">
            <Setter Property="Background" Value="#dcdcdc" />
            <Setter Property="Opacity" Value="1" />
        </Style>
        <Style Selector="Button:pointerover /template/ ContentPresenter">
            <Setter Property="Opacity" Value="1" />
        </Style>
    </UserControl.Styles>
    <Grid RowDefinitions="Auto,*"
          ColumnDefinitions="3*,2*">
        <Border Grid.ColumnSpan="2"
                Padding="0 0 0 4">
            <StackPanel Orientation="Horizontal"
                        Spacing="16"
                        VerticalAlignment="Center">
                <TextBlock Text="{Binding RoomName}"
                           FontSize="20"
                           FontWeight="SemiBold" />
            </StackPanel>
        </Border>

        <Border Grid.Row="1"
                Background="#f7f7f7"
                CornerRadius="12"
                Padding="8">
            <Grid>
                <ItemsControl ItemsSource="{Binding Cells}"
                              IsEnabled="{Binding IsBoardEnabled}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <primitives:UniformGrid Columns="{Binding BoardSize}"
                                                    Rows="{Binding BoardSize}" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="vm:BoardCellViewModel">
                            <Button Command="{Binding ClickCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="0"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch">
                                <Border Background="{Binding Background}"
                                        CornerRadius="4"
                                        Margin="1"
                                        Padding="2">
                                    <Grid>
                                        <Ellipse Fill="{Binding Piece.Fill}"
                                                 Stroke="{Binding Piece.Stroke}"
                                                 StrokeThickness="2"
                                                 IsVisible="{Binding HasPiece}" />
                                        <TextBlock Text="♔"
                                                   FontWeight="Bold"
                                                   Foreground="#d9b650"
                                                   FontSize="25"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   IsVisible="{Binding Piece.IsKing, FallbackValue=False}" />
                                    </Grid>
                                </Border>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <Border Background="#FFF5F5F5"
                        Opacity="0.5"
                        IsVisible="{Binding ShowPauseOverlay}" />
            </Grid>
        </Border>

        <Border Grid.Row="1"
                Grid.Column="1"
                Padding="12"
                Background="#fdfdfd"
                BorderBrush="#e6e6e6"
                BorderThickness="1"
                CornerRadius="12">
            <StackPanel Spacing="12">
                <TextBlock Text="Stav hry"
                           FontSize="16"
                           FontWeight="SemiBold" />
                <StackPanel Orientation="Horizontal"
                            Spacing="6"
                            VerticalAlignment="Center">
                    <Ellipse Width="8"
                             Height="8"
                             Fill="{Binding ServerStatusBrush}"
                             VerticalAlignment="Center" />
                    <TextBlock Text="{Binding ServerStatusText}"
                               Foreground="Gray" />
                </StackPanel>

                <StackPanel Orientation="Horizontal"
                            Spacing="8"
                            VerticalAlignment="Center">
                    <Ellipse Width="12"
                             Height="12"
                             Fill="{Binding OpponentFill}"
                             Stroke="{Binding OpponentStroke}"
                             StrokeThickness="1"
                             VerticalAlignment="Center" />
                    <TextBlock Text="Soupeřova barva" />
                    <TextBlock Text="{Binding OpponentTimer}"
                               Foreground="Gray"
                               Margin="6 0 0 0"
                               IsVisible="{Binding IsOpponentClockActive}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal"
                            Spacing="8"
                            VerticalAlignment="Center">
                    <Ellipse Width="12"
                             Height="12"
                             Fill="{Binding PlayerFill}"
                             Stroke="{Binding PlayerStroke}"
                             StrokeThickness="1"
                             VerticalAlignment="Center" />
                    <TextBlock Text="Tvoje barva" />
                    <TextBlock Text="{Binding PlayerTimer}"
                               Foreground="Gray"
                               IsVisible="{Binding IsMyClockActive}"
                               Margin="6 0 0 0" />
                </StackPanel>

                <TextBlock Text="Na tahu:"
                           FontWeight="SemiBold" />
                <TextBlock Text="{Binding CurrentTurnDisplay}"
                           FontSize="14"
                           Foreground="#0063b1" />

                <Separator />

                <TextBlock Text="Poznámky"
                           FontWeight="SemiBold" />
                <TextBlock Text="{Binding StatusMessage}"
                           TextWrapping="Wrap" />

                <StackPanel Spacing="6">
                    <Button Content="Opustit hru"
                            Command="{Binding RequestLeaveCommand}"
                            HorizontalAlignment="Stretch" />
                    <Border Background="#fff8e1"
                            BorderBrush="#e6c200"
                            BorderThickness="1"
                            Padding="8"
                            CornerRadius="6"
                            IsVisible="{Binding ShowLeaveConfirm}">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Opravdu si přejete odejít? Pokud ano, automaticky prohráváte."
                                       TextWrapping="Wrap" />
                            <StackPanel Orientation="Horizontal"
                                        Spacing="8"
                                        HorizontalAlignment="Right">
                                <Button Content="Ano"
                                        Command="{Binding ConfirmLeaveCommand}" />
                                <Button Content="Zůstat"
                                        Command="{Binding CancelLeaveCommand}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
